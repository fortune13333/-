# 链踪本地代理: 打包与分发指南

本指南将指导您如何将 `agent.py` 脚本打包成一个独立的 Windows 可执行文件 (`.exe`)，并说明如何将其与配置文件一起分发给最终用户。

## 概览

我们将使用 **PyInstaller** 工具来完成打包。最终的分发包将包含两个核心文件：

1.  `agent.exe`: 编译好的可执行程序。用户无需安装Python即可运行。
2.  `config.ini`: 一个简单易懂的文本配置文件。所有设备信息和登录凭据都在这里修改，**无需再编辑任何代码**。

---

## 步骤 1: 准备环境

您只需要一个安装了 Python 的 Windows 环境。

1.  **确认文件**: 确保您的文件夹中包含以下文件：
    -   `agent.py` (新版本，能读取 `config.ini`)
    -   `config.ini` (配置文件模板)
    -   `requirements.txt`
    -   `build.bat` (我们提供的构建脚本)

2.  **(可选) 安装依赖**: 如果您想在打包前先以源码方式运行测试，可以打开终端并运行：
    ```bash
    pip install -r requirements.txt
    ```

---

## 步骤 2: 构建 `.exe` 文件

这是最简单的一步！

**只需双击运行 `build.bat` 文件即可。**

脚本会自动执行以下操作：
1.  检查并安装 PyInstaller。
2.  调用 PyInstaller 将 `agent.py` 打包成一个名为 `agent.exe` 的单文件程序。
3.  构建完成后，您会在一个新创建的 `dist` 文件夹中找到 `agent.exe`。

---

## 步骤 3: 分发和运行

1.  **创建分发文件夹**: 在任意位置创建一个新文件夹，例如 `ChainTrace Agent Client`。

2.  **复制文件**: 将以下 **两个** 文件复制到您刚刚创建的新文件夹中：
    -   `dist/agent.exe`
    -   `config.ini`

3.  **配置**: 使用记事本或任何文本编辑器打开 `config.ini` 文件，并根据最终用户的实际网络环境填写以下信息：
    -   `[credentials]`: 用户的设备登录名和密码。
    -   `[device_map]`: 用户需要管理的设备列表。

4.  **运行**: 双击 `agent.exe` 即可启动代理服务。它会在后台运行，您可以在任务管理器的进程中看到它。

**重要**:
-   `agent.exe` 和 `config.ini` **必须**始终放在同一个文件夹中。
-   当用户需要添加新设备或修改凭据时，只需编辑 `config.ini` 文件，然后**重启 `agent.exe`** 即可生效（在任务管理器中结束旧进程，然后重新双击运行）。

---

## 为什么要使用 `config.ini`？

-   **用户友好**: 最终用户（如网络管理员）不应被要求去修改 Python 代码。`.ini` 格式清晰明了，易于理解和编辑。
-   **职责分离**: 代码 (`.py`) 负责逻辑，配置 (`.ini`) 负责数据。这是更专业的软件设计模式。
-   **灵活性**: 无需重新打包 `.exe` 就可以动态增删设备。
